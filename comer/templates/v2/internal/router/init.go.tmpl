/*
generated by comer,https://github.com/imoowi/comer
Copyright Â© 2023 jun<simpleyuan@gmail.com>
*/
package router

import (
	"github.com/gin-gonic/gin"
	"github.com/imoowi/comer/utils/response"
	"{{.moduleName}}/internal/middlewares"
)

type Router func(*gin.Engine)

var routers = []Router{}

func InitRouter() *gin.Engine {
	r := gin.Default()
	middlewares.InitMiddleware(r)
	for _, route := range routers {
		route(r)

	}
	r.GET(`/api/casbins/allapi`, func(ctx *gin.Context) {

		// @Router       /api/casbins/allapi [get]
		routers := r.Routes()
		allapi := make([]map[string]string, 0)
		for _, v := range routers {
			allapi = append(allapi, map[string]string{"method": v.Method, "path": v.Path})
		}
		response.OK(allapi, ctx)
	})
	return r
}

func RegisterRoute(r ...Router) {
	routers = append(routers, r...)
}
