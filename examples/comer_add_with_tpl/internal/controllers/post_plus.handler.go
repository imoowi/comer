// generated by "comer add-with-tpl"
// © 2024 IMOOWI. All Rights Reserved.
//
//	@Author	yuanjun<imoowi@qq.com>
package controllers

import (
	"net/http"

	"github.com/imoowi/examples/comer_add_with_tpl/internal/global"
	"github.com/imoowi/examples/comer_add_with_tpl/internal/models"
	"github.com/imoowi/examples/comer_add_with_tpl/internal/services"
	"github.com/imoowi/examples/comer_add_with_tpl/pkg/frame"

	"github.com/spf13/cast"
)

// @Summary	分页列表(pagelist)
// @Tags		PostPlus(页面加)
// @Accept		application/json
// @Produce	application/json
// @Param		Authorization	header		string				true	"Bearer 用户令牌"
//
//	@Param		{object}		query		models.PostPlusQuery	false	"请求参数"
//
// @Success	200				{object}	response.PageList	"成功"
// @Failure	400				{object}	string				"请求错误"
// @Failure	401				{object}	string				"token验证失败"
// @Failure	500				{object}	string				"内部错误"
// @Router		/api/projects/{project_id}/post-pluss [get]
func PostPlusPageList(c *frame.Context) {
	var req models.PostPlusQuery
	err := c.ShouldBindQuery(&req)
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	if 0 >= req.PageSize {
		result, err := services.PostPlus.All(c, &req)
		if err != nil {
			c.ResponseErr(err.Error(), http.StatusBadRequest)
			return
		}
		c.ResponseOk(result)
		return
	}
	result, err := services.PostPlus.PageList(c, &req)
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	c.ResponseOk(result)
}

// @Summary	详情(one)
// @Tags		PostPlus(页面加)
// @Accept		application/json
// @Produce	application/json
// @Param		Authorization	header	string	true	"Bearer 用户令牌"
// @Param		id				path	int		true	"id"
// @Success	200
// @Failure	400	{object}	string	"请求错误"
// @Failure	401	{object}	string	"token验证失败"
// @Failure	500	{object}	string	"内部错误"
// @Router		/api/projects/{project_id}/post-pluss/{id} [get]
func PostPlusOne(c *frame.Context) {
	id := c.Param(`id`)
	if id == `` {
		c.ResponseErr(`pls input id`, http.StatusBadRequest)
		return
	}
	one, err := services.PostPlus.One(c, cast.ToUint(id))
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	c.ResponseOk(one)
}

// @Summary	新增(add)
// @Tags		PostPlus(页面加)
// @Accept		application/json
// @Produce	application/json
// @Param		Authorization	header	string		true	"Bearer 用户令牌"
// @Param		{object}		body	models.Page	true	"body"
// @Success	200
// @Failure	400	{object}	string	"请求错误"
// @Failure	401	{object}	string	"token验证失败"
// @Failure	500	{object}	string	"内部错误"
// @Router		/api/projects/{project_id}/post-pluss [post]
func PostPlusAdd(c *frame.Context) {
	var page *models.PostPlus
	err := c.ShouldBindJSON(&page)
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	newId, err := services.PostPlus.Add(c, page)
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	c.Set(`user_log_obj_id`, newId)
	c.Set(`user_log_res_type`, global.RES_TYPE_NULL)
	c.ResponseOk(newId)
}

// @Summary	更新(update)
// @Tags		PostPlus(页面加)
// @Accept		application/json
// @Produce	application/json
// @Param		Authorization	header	string		true	"Bearer 用户令牌"
// @Param		id				path	int			true	"id"
// @Param		{object}		body	models.Page	true	"body"
// @Success	200
// @Failure	400	{object}	string	"请求错误"
// @Failure	401	{object}	string	"token验证失败"
// @Failure	500	{object}	string	"内部错误"
// @Router		/api/projects/{project_id}/post-pluss/{id} [put]
func PostPlusUpdate(c *frame.Context) {
	id := c.Param(`id`)
	if id == `` {
		c.ResponseErr(`pls input id`, http.StatusBadRequest)
		return
	}
	var page *models.PostPlus
	err := c.ShouldBindJSON(&page)
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	updated, err := services.PostPlus.Update(c, page, cast.ToUint(id))
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	c.Set(`user_log_obj_id`, id)
	c.Set(`user_log_res_type`, global.RES_TYPE_NULL)
	c.ResponseOk(updated)
}

// @Summary	删除(delete)
// @Tags		PostPlus(页面加)
// @Accept		application/json
// @Produce	application/json
// @Param		Authorization	header	string	true	"Bearer 用户令牌"
// @Param		id				path	int		true	"id"
// @Success	200
// @Failure	400	{object}	string	"请求错误"
// @Failure	401	{object}	string	"token验证失败"
// @Failure	500	{object}	string	"内部错误"
// @Router		/api/projects/{project_id}/post-pluss/{id} [delete]
func PostPlusDel(c *frame.Context) {
	id := c.Param(`id`)
	if id == `` {
		c.ResponseErr(`pls input id`, http.StatusBadRequest)
		return
	}
	deleted, err := services.PostPlus.Delete(c, cast.ToUint(id))
	if err != nil {
		c.ResponseErr(err.Error(), http.StatusBadRequest)
		return
	}
	c.Set(`user_log_obj_id`, id)
	c.Set(`user_log_res_type`, global.RES_TYPE_NULL)
	c.ResponseOk(deleted)
}
